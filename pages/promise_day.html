<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Our Forever</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;600&family=Cormorant+Garamond:ital,wght@1,600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            /* Golden Hour Palette */
            --bg-top: #ff9a9e;
            --bg-mid: #fecfef;
            --bg-bot: #a18cd1;
            
            --primary: #d63384; /* Deep Pink */
            --gold: #ffd700;
            --glass: rgba(255, 255, 255, 0.25);
            --border: rgba(255, 255, 255, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            height: 100vh; width: 100vw; overflow: hidden;
            background: linear-gradient(to bottom, var(--bg-top), var(--bg-mid), var(--bg-bot));
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            font-family: 'Montserrat', sans-serif;
            user-select: none; touch-action: none;
            position: relative;
        }

        /* --- BACKGROUND LAYERS --- */
        .sun {
            position: absolute; top: 15%; right: 50%;
            transform: translateX(50%);
            width: 150px; height: 150px;
            background: radial-gradient(circle, #fff, rgba(255,255,255,0));
            border-radius: 50%; opacity: 0.8;
            filter: blur(20px); pointer-events: none;
            transition: transform 0.1s ease-out;
        }

        #worldCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; pointer-events: none;
        }

        /* --- UI CONTAINER --- */
        .ui-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding-bottom: 15%; pointer-events: none;
            transition: opacity 0.8s;
        }

        /* START BUTTON */
        .start-wrapper {
            pointer-events: auto; position: relative;
            display: flex; flex-direction: column; align-items: center;
        }

        .hint-text {
            color: #fff; font-size: 1.1rem; letter-spacing: 3px;
            text-transform: uppercase; margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-family: 'Cormorant Garamond', serif;
        }

        .bloom-btn {
            width: 90px; height: 90px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; color: white; cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            transition: transform 0.3s;
            animation: pulse 2s infinite;
        }
        .bloom-btn:active { transform: scale(0.95); background: rgba(255,255,255,0.4); }

        /* --- PROPOSAL CARD --- */
        .card {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 85%; max-width: 380px;
            background: var(--glass);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            padding: 40px 30px; border-radius: 24px;
            border: 1px solid var(--border);
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            opacity: 0; pointer-events: none;
            transition: 1s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 20;
        }
        .card.active { opacity: 1; pointer-events: auto; transform: translate(-50%, -50%) scale(1); }

        .ring-icon {
            font-size: 4rem; color: var(--gold); margin-bottom: 15px;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
            animation: float 4s infinite ease-in-out;
        }

        .title {
            font-family: 'Great Vibes', cursive; font-size: 3.2rem;
            color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            line-height: 1.1; margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1rem; color: #fff; opacity: 0.9;
            margin-bottom: 30px; font-weight: 300; line-height: 1.5;
        }

        .btn-group { display: flex; gap: 15px; justify-content: center; }

        .btn {
            padding: 14px 35px; border-radius: 50px; border: none;
            font-size: 1rem; font-weight: 600; cursor: pointer;
            letter-spacing: 1px; transition: 0.3s;
        }

        .btn-yes {
            background: white; color: var(--primary);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .btn-yes:active { transform: scale(0.95); }

        .btn-no {
            background: rgba(255,255,255,0.2); color: white;
            border: 1px solid rgba(255,255,255,0.4);
        }

        /* --- JOURNEY SLIDESHOW --- */
        .journey-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #2b1018 0%, #000 100%);
            z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 1s;
        }
        .journey-layer.active { opacity: 1; pointer-events: auto; }

        .photo-frame {
            background: white; padding: 12px 12px 50px 12px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: rotate(-3deg); transition: 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            width: 80%; max-width: 320px; border-radius: 4px;
        }
        .photo-frame img { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #eee; display: block; }
        
        .caption-text {
            margin-top: 30px; font-family: 'Great Vibes'; font-size: 2rem; color: #ff005c;
            text-align: center; min-height: 50px; text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .continue-btn {
            margin-top: 40px; background: transparent; color: white;
            border: 1px solid rgba(255,255,255,0.5); padding: 12px 40px;
            border-radius: 30px; cursor: pointer; transition: 0.3s;
            text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem;
        }

        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(255,255,255,0); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    </style>
</head>
<body>

    <div class="sun" id="sun"></div>

    <canvas id="worldCanvas"></canvas>

    <div class="ui-container" id="startUI">
        <div class="start-wrapper">
            <div class="hint-text">Let Love Bloom</div>
            <div class="bloom-btn" id="startBtn"><i class="fas fa-heart"></i></div>
        </div>
    </div>

    <div class="card" id="proposalCard">
        <i class="fas fa-ring ring-icon"></i>
        <div class="title">Will You Marry Me?</div>
        <div class="subtitle">Just say yes, and I'll give you the world.</div>
        <div class="btn-group">
            <button class="btn btn-yes" id="yesBtn">YES</button>
            <button class="btn btn-no" id="noBtn">No</button>
        </div>
    </div>

    <div class="journey-layer" id="journeyUI">
        <div class="photo-frame" id="photoFrame">
            <img src="" id="memImg">
        </div>
        <div class="caption-text" id="memText"></div>
        <button class="continue-btn" id="nextBtn">Continue</button>
    </div>

    <script>
        /* --- CONFIGURATION --- */
        // CHANGE THESE IMAGES AND TEXTS
        const memories = [
            { img: "https://images.unsplash.com/photo-1511988617509-a57c8a288659?w=400", text: "My Safe Place" },
            { img: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400", text: "My Endless Joy" },
            { img: "https://images.unsplash.com/photo-1522075469751-3a6694fb2f61?w=400", text: "My Forever" },
            { img: "https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?w=400", text: "My Destiny" }
        ];

        /* --- ENGINE SETUP --- */
        const canvas = document.getElementById('worldCanvas');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        let w, h;

        function resize() {
            w = window.innerWidth;
            h = window.innerHeight;
            canvas.width = w * dpr;
            canvas.height = h * dpr;
            ctx.scale(dpr, dpr);
        }
        window.addEventListener('resize', resize);
        resize();

        // CACHED FLOWER SPRITE (Optimized for performance)
        const flowerCanvas = document.createElement('canvas');
        flowerCanvas.width = 40; flowerCanvas.height = 40;
        const fCtx = flowerCanvas.getContext('2d');
        fCtx.translate(20, 20);
        fCtx.fillStyle = '#ff9a9e'; // Pink petal
        for(let i=0; i<5; i++) {
            fCtx.rotate((Math.PI*2)/5);
            fCtx.beginPath(); fCtx.ellipse(0, -10, 5, 10, 0, 0, Math.PI*2); fCtx.fill();
        }
        fCtx.fillStyle = '#fff'; // White Center
        fCtx.beginPath(); fCtx.arc(0,0,3,0,Math.PI*2); fCtx.fill();


        /* --- MOUSE PARALLAX --- */
        const sun = document.getElementById('sun');
        let mouseX = w/2, mouseY = h/2;
        
        window.addEventListener('mousemove', e => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            // Parallax Sun
            const moveX = (w/2 - mouseX) * 0.05;
            const moveY = (h/2 - mouseY) * 0.05;
            sun.style.transform = `translate(calc(-50% + ${moveX}px), ${moveY}px)`;
        });

        /* --- LOGIC STATE --- */
        let branches = [];
        let blooms = [];
        let particles = []; // Fireflies & Petals
        let running = false;
        const isMobile = w < 768;

        /* --- ANIMATION LOOP --- */
        function loop() {
            if(!running) return;

            // Clear with slight transparency trail? No, clean clear for crispness
            ctx.clearRect(0,0,w,h);

            let growing = false;

            // 1. FIREFLIES
            if(particles.length < 30) {
                particles.push({
                    x: Math.random()*w, y: Math.random()*h,
                    vx: (Math.random()-0.5)*0.5, vy: (Math.random()-0.5)*0.5,
                    size: Math.random()*2, alpha: 0, type: 'firefly'
                });
            }

            // 2. TREE BRANCHES
            branches.forEach(b => {
                ctx.beginPath();
                ctx.moveTo(b.x, b.y);
                const endX = b.x + Math.cos(b.angle) * b.len;
                const endY = b.y + Math.sin(b.angle) * b.len;
                
                // Gradient Trunk
                const grad = ctx.createLinearGradient(b.x, b.y, endX, endY);
                grad.addColorStop(0, '#4a3b32'); grad.addColorStop(1, '#6d4c41');
                ctx.strokeStyle = grad; 
                ctx.lineWidth = b.width; ctx.lineCap = "round";
                ctx.lineTo(endX, endY); ctx.stroke();

                if(b.len < b.maxLen) {
                    b.len += 4; growing = true;
                } else if(!b.done) {
                    b.done = true;
                    // Split
                    if(b.gen < (isMobile?3:4)) {
                        for(let i=0; i<2; i++) {
                            branches.push({
                                x: endX, y: endY,
                                angle: b.angle + (Math.random()-0.5),
                                len: 0, maxLen: b.maxLen*0.7, width: b.width*0.7,
                                color: b.color, gen: b.gen+1, done: false
                            });
                        }
                    } else {
                        // Bloom Spawn
                        blooms.push({ x: endX, y: endY, scale: 0 });
                    }
                }
            });

            // 3. BLOOMS
            blooms.forEach(f => {
                if(f.scale < 1) f.scale += 0.05;
                const s = f.scale * 30;
                ctx.drawImage(flowerCanvas, f.x - s/2, f.y - s/2, s, s);
                
                // Drop Petal Chance
                if(Math.random() < 0.005) {
                    particles.push({
                        x: f.x, y: f.y,
                        vx: (Math.random()-0.5), vy: Math.random() + 1,
                        size: 3, alpha: 1, type: 'petal', rot: Math.random()
                    });
                }
            });

            // 4. PARTICLES UPDATE
            for(let i=particles.length-1; i>=0; i--) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy;

                if(p.type === 'firefly') {
                    p.alpha += (Math.random()-0.5)*0.1;
                    if(p.alpha < 0) p.alpha = 0; if(p.alpha > 1) p.alpha = 1;
                    ctx.fillStyle = `rgba(255, 255, 200, ${p.alpha})`;
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
                } else {
                    // Petal
                    p.x += Math.sin(p.y/50)*0.5; // Wind
                    p.rot += 0.1;
                    ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
                    ctx.fillStyle = `rgba(255, 183, 197, ${p.alpha})`;
                    ctx.beginPath(); ctx.ellipse(0,0, 2, 4, 0, 0, Math.PI*2); ctx.fill();
                    ctx.restore();
                    if(p.y > h) particles.splice(i,1);
                }
            }

            if(growing || particles.length > 0) requestAnimationFrame(loop);
            
            // Trigger UI
            if(!growing && !document.getElementById('proposalCard').classList.contains('active')) {
                setTimeout(() => {
                    document.getElementById('proposalCard').classList.add('active');
                    confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: ['#ffd700', '#fff'] });
                }, 800);
            }
        }

        // --- EVENTS ---
        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('startUI').style.opacity = 0;
            setTimeout(() => document.getElementById('startUI').style.display = 'none', 800);
            
            running = true;
            branches.push({
                x: w/2, y: h, angle: -Math.PI/2,
                len: 0, maxLen: h/3.5, width: 22,
                color: '#3e2723', gen: 0, done: false
            });
            loop();
        });

        // Smart No Button
        const noBtn = document.getElementById('noBtn');
        const moveNo = (e) => {
            const maxX = w - 100; const maxY = h - 50;
            noBtn.style.position = 'fixed';
            noBtn.style.left = Math.random() * maxX + 'px';
            noBtn.style.top = Math.random() * maxY + 'px';
        };
        noBtn.addEventListener('mouseover', moveNo); noBtn.addEventListener('touchstart', moveNo);

        // Slideshow
        const yesBtn = document.getElementById('yesBtn');
        const journeyUI = document.getElementById('journeyUI');
        const memImg = document.getElementById('memImg');
        const memText = document.getElementById('memText');
        const photoFrame = document.getElementById('photoFrame');
        let idx = 0;

        yesBtn.addEventListener('click', () => {
            document.getElementById('proposalCard').style.opacity = 0;
            journeyUI.classList.add('active');
            updateSlide();
        });

        function updateSlide() {
            photoFrame.style.transform = "rotate(5deg) scale(0.9)"; photoFrame.style.opacity = 0;
            memText.style.opacity = 0;
            setTimeout(() => {
                memImg.src = memories[idx].img;
                memText.innerText = memories[idx].text;
                photoFrame.style.transform = "rotate(-2deg) scale(1)"; photoFrame.style.opacity = 1;
                memText.style.opacity = 1;
            }, 500);
        }

        document.getElementById('nextBtn').addEventListener('click', () => {
            if(idx < memories.length-1) { idx++; updateSlide(); }
            else {
                for(let i=0; i<15; i++) {
                    setTimeout(() => {
                        const k = document.createElement('div'); k.innerText = 'ðŸ’‹';
                        k.style.position='fixed'; k.style.left=Math.random()*100+'vw'; k.style.top='100vh';
                        k.style.fontSize='3rem'; k.style.transition='2s'; k.style.zIndex=200;
                        document.body.appendChild(k);
                        setTimeout(()=>k.style.transform='translateY(-120vh)',50);
                    }, i*200);
                }
                setTimeout(() => window.location.href="dashboard.html", 3000);
            }
        });
    </script>
</body>
</html>